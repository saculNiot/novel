'use client'
import Be from"@tiptap/starter-kit";import _ from"@tiptap/extension-horizontal-rule";import _e from"@tiptap/extension-link";import Ve from"@tiptap/extension-image";import Q from"@tiptap/extension-placeholder";import V from"@tiptap/extension-underline";import G from"@tiptap/extension-text-style";import{Color as J}from"@tiptap/extension-color";import{TaskItem as je}from"@tiptap/extension-task-item";import{TaskList as tt}from"@tiptap/extension-task-list";import{InputRule as X}from"@tiptap/core";import{Markdown as Y}from"tiptap-markdown";import Z from"@tiptap/extension-highlight";import x from"@tiptap/extension-image";var C=x.extend({name:"image",addAttributes(){return{...this.parent?.(),width:{default:null},height:{default:null}}}}),b=C;import{Extension as E}from"@tiptap/core";var T=E.create({name:"CustomKeymap",addCommands(){return{selectTextWithinNodeBoundaries:()=>({editor:e,commands:o})=>{let{state:t}=e,{tr:r}=t,n=r.selection.$from.start(),i=r.selection.$to.end();return o.setTextSelection({from:n,to:i})}}},addKeyboardShortcuts(){return{"Mod-a":({editor:e})=>{let{state:o}=e,{tr:t}=o,r=t.selection.from,n=t.selection.to,i=t.selection.$from.start(),a=t.selection.$to.end();return r>i||n<a?(e.chain().selectTextWithinNodeBoundaries().run(),!0):!1}}}}),p=T;import I from"react-moveable";import{useCurrentEditor as A}from"@tiptap/react";import{jsx as w}from"react/jsx-runtime";var k=()=>{let{editor:e}=A();if(!e?.isActive("image"))return null;let o=()=>{let t=document.querySelector(".ProseMirror-selectednode");if(t){let r=e.state.selection,n=e.commands.setImage;n({src:t.src,width:Number(t.style.width.replace("px","")),height:Number(t.style.height.replace("px",""))}),e.commands.setNodeSelection(r.from)}};return w(I,{target:document.querySelector(".ProseMirror-selectednode"),container:null,origin:!1,edge:!1,throttleDrag:0,keepRatio:!0,resizable:!0,throttleResize:0,onResize:({target:t,width:r,height:n,delta:i})=>{i[0]&&(t.style.width=`${r}px`),i[1]&&(t.style.height=`${n}px`)},onResizeEnd:()=>{o()},scalable:!0,throttleScale:0,renderDirections:["w","e"],onScale:({target:t,transform:r})=>{t.style.transform=r}})};import j from"tiptap-extension-global-drag-handle";import ee from"tiptap-extension-auto-joiner";import{Mark as S,markInputRule as H,markPasteRule as v,mergeAttributes as P}from"@tiptap/core";var M=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,N=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,le=S.create({name:"ai-highlight",addOptions(){return{HTMLAttributes:{}}},addAttributes(){return{color:{default:null,parseHTML:e=>e.getAttribute("data-color")||e.style.backgroundColor,renderHTML:e=>e.color?{"data-color":e.color,style:`background-color: ${e.color}; color: inherit`}:{}}}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:e}){return["mark",P(this.options.HTMLAttributes,e),0]},addCommands(){return{setAIHighlight:e=>({commands:o})=>o.setMark(this.name,e),toggleAIHighlight:e=>({commands:o})=>o.toggleMark(this.name,e),unsetAIHighlight:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleAIHighlight()}},addInputRules(){return[H({find:M,type:this.type})]},addPasteRules(){return[v({find:N,type:this.type})]}}),ue=e=>{let o=e.state.tr;o.removeMark(0,e.state.doc.nodeSize-2,e.state.schema.marks["ai-highlight"]),e.view.dispatch(o)},pe=(e,o)=>{e.chain().setAIHighlight({color:o??"#c1ecf970"}).run()};import{Extension as U}from"@tiptap/core";import q from"@tiptap/suggestion";import{ReactRenderer as B}from"@tiptap/react";import W from"tippy.js";import{useAtom as L,useSetAtom as h}from"jotai";import{useEffect as l,forwardRef as K,createContext as D}from"react";import{Command as u}from"cmdk";import{atom as g}from"jotai";var d=g(""),f=g(null);import{createStore as z}from"jotai";var c=z();import{jsx as m,jsxs as $}from"react/jsx-runtime";var y=D({}),R=({query:e,range:o})=>{let t=h(d,{store:c}),r=h(f,{store:c});return l(()=>{t(e)},[e,t]),l(()=>{r(o)},[o,r]),l(()=>{let n=["ArrowUp","ArrowDown","Enter"],i=a=>{if(n.includes(a.key)){a.preventDefault();let s=document.querySelector("#slash-command");return s&&s.dispatchEvent(new KeyboardEvent("keydown",{key:a.key,cancelable:!0,bubbles:!0})),!1}};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[]),m(y.Consumer,{children:n=>m(n.Out,{})})},O=K(({children:e,className:o,...t},r)=>{let[n,i]=L(d);return m(y.Consumer,{children:a=>m(a.In,{children:$(u,{ref:r,onKeyDown:s=>{s.stopPropagation()},id:"slash-command",className:o,...t,children:[m(u.Input,{value:n,onValueChange:i,style:{display:"none"}}),e]})})})}),Ae=u.List;O.displayName="EditorCommand";var Ne=U.create({name:"slash-command",addOptions(){return{suggestion:{char:"/",command:({editor:e,range:o,props:t})=>{t.command({editor:e,range:o})}}}},addProseMirrorPlugins(){return[q({editor:this.editor,...this.options.suggestion})]}}),ze=()=>{let e=null,o=null;return{onStart:t=>{e=new B(R,{props:t,editor:t.editor});let{selection:r}=t.editor.state;if(r.$from.node(r.$from.depth).type.name==="codeBlock")return!1;o=W("body",{getReferenceClientRect:t.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:t=>{e?.updateProps(t),o&&o[0].setProps({getReferenceClientRect:t.clientRect})},onKeyDown:t=>t.event.key==="Escape"?(o?.[0].hide(),!0):e?.ref?.onKeyDown(t),onExit:()=>{o?.[0].destroy(),e?.destroy()}}},Le=e=>e,Ke=e=>{if(["ArrowUp","ArrowDown","Enter"].includes(e.key)&&document.querySelector("#slash-command"))return!0};import"@tiptap/core";var F=(e,{chars:o,offset:t=0})=>e.storage.markdown.getMarkdown();var ct=Q.configure({placeholder:({node:e})=>e.type.name==="heading"?`Heading ${e.attrs.level}`:"Press '/' for commands",includeChildren:!0}),lt=[V,G,J,Z.configure({multicolor:!0}),Y.configure({transformPastedText:!0}),p,j.configure({scrollTreshold:0}),ee],ut=_.extend({addInputRules(){return[new X({find:/^(?:---|â€”-|___\s|\*\*\*\s)$/u,handler:({state:e,range:o})=>{let t={},{tr:r}=e,n=o.from,i=o.to;r.insert(n-1,this.type.create(t)).delete(r.mapping.map(n),r.mapping.map(i))}})]}});export{b as a,k as b,M as c,N as d,le as e,ue as f,pe as g,f as h,c as i,y as j,O as k,Ae as l,Ne as m,ze as n,Le as o,Ke as p,F as q,Be as r,_e as s,Ve as t,je as u,tt as v,X as w,ct as x,lt as y,ut as z};
