'use client'
import{Plugin as U,PluginKey as y}from"@tiptap/pm/state";import{Decoration as D,DecorationSet as I}from"@tiptap/pm/view";var c=new y("upload-image"),E=({imageClass:n})=>new U({key:c,state:{init(){return I.empty},apply(e,o){o=o.map(e.mapping,e.doc);let t=e.getMeta(this);if(t&&t.add){let{id:a,pos:r,src:l}=t.add,d=document.createElement("div");d.setAttribute("class","img-placeholder");let i=document.createElement("img");i.setAttribute("class",n),i.src=l,d.appendChild(i);let s=D.widget(r+1,d,{id:a});o=o.add(e.doc,[s])}else t&&t.remove&&(o=o.remove(o.find(void 0,void 0,a=>a.id==t.remove.id)));return o}},props:{decorations(e){return this.getState(e)}}});function F(n,e){let t=c.getState(n).find(void 0,void 0,a=>a.id==e);return t.length?t[0]?.from:null}var b=({validateFn:n,onUpload:e})=>(o,t,a,r)=>{if(!n?.(o))return;let d={},i=t.state.tr;i.selection.empty||i.deleteSelection();let s=new FileReader;s.readAsDataURL(o),s.onload=()=>{i.setMeta(c,{add:{id:d,pos:a,src:s.result}}),t.dispatch(i)},e(o,r).then(f=>{let{schema:u}=t.state,p=F(t.state,d);if(p==null)return;let g=typeof f=="object"?s.result:f,m=u.nodes.image?.create({src:g});if(!m)return;let h=t.state.tr.replaceWith(p,p,m).setMeta(c,{remove:{id:d}});t.dispatch(h)})},P=(n,e,o,t)=>{if(e.clipboardData?.files.length){e.preventDefault();let[a]=Array.from(e.clipboardData.files),r=n.state.selection.from;return a&&o(a,n,r,t),!0}return!1},S=(n,e,o,t,a)=>{if(!o&&e.dataTransfer?.files.length){e.preventDefault();let[r]=Array.from(e.dataTransfer.files),l=n.posAtCoords({left:e.clientX,top:e.clientY});return r&&t(r,n,l?.pos??-1,a),!0}return!1};export{E as UploadImagesPlugin,b as createImageUpload,S as handleImageDrop,P as handleImagePaste};
