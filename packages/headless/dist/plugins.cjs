'use client'
var u=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var A=(a,e)=>{for(var o in e)u(a,o,{get:e[o],enumerable:!0})},C=(a,e,o,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of S(e))!x.call(a,n)&&n!==o&&u(a,n,{get:()=>e[n],enumerable:!(t=P(e,n))||t.enumerable});return a};var V=a=>C(u({},"__esModule",{value:!0}),a);var M={};A(M,{UploadImagesPlugin:()=>U,createImageUpload:()=>y,handleImageDrop:()=>I,handleImagePaste:()=>D});module.exports=V(M);var p=require("@tiptap/pm/state"),f=require("@tiptap/pm/view"),c=new p.PluginKey("upload-image"),U=({imageClass:a})=>new p.Plugin({key:c,state:{init(){return f.DecorationSet.empty},apply(e,o){o=o.map(e.mapping,e.doc);let t=e.getMeta(this);if(t&&t.add){let{id:n,pos:r,src:l}=t.add,d=document.createElement("div");d.setAttribute("class","img-placeholder");let i=document.createElement("img");i.setAttribute("class",a),i.src=l,d.appendChild(i);let s=f.Decoration.widget(r+1,d,{id:n});o=o.add(e.doc,[s])}else t&&t.remove&&(o=o.remove(o.find(void 0,void 0,n=>n.id==t.remove.id)));return o}},props:{decorations(e){return this.getState(e)}}});function w(a,e){let t=c.getState(a).find(void 0,void 0,n=>n.id==e);return t.length?t[0]?.from:null}var y=({validateFn:a,onUpload:e})=>(o,t,n,r)=>{if(!a?.(o))return;let d={},i=t.state.tr;i.selection.empty||i.deleteSelection();let s=new FileReader;s.readAsDataURL(o),s.onload=()=>{i.setMeta(c,{add:{id:d,pos:n,src:s.result}}),t.dispatch(i)},e(o,r).then(g=>{let{schema:E}=t.state,m=w(t.state,d);if(m==null)return;let F=typeof g=="object"?s.result:g,h=E.nodes.image?.create({src:F});if(!h)return;let b=t.state.tr.replaceWith(m,m,h).setMeta(c,{remove:{id:d}});t.dispatch(b)})},D=(a,e,o,t)=>{if(e.clipboardData?.files.length){e.preventDefault();let[n]=Array.from(e.clipboardData.files),r=a.state.selection.from;return n&&o(n,a,r,t),!0}return!1},I=(a,e,o,t,n)=>{if(!o&&e.dataTransfer?.files.length){e.preventDefault();let[r]=Array.from(e.dataTransfer.files),l=a.posAtCoords({left:e.clientX,top:e.clientY});return r&&t(r,a,l?.pos??-1,n),!0}return!1};0&&(module.exports={UploadImagesPlugin,createImageUpload,handleImageDrop,handleImagePaste});
